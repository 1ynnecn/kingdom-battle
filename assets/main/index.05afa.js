window.__require=function t(e,i,s){function a(n,_){if(!i[n]){if(!e[n]){var r=n.split("/");if(r=r[r.length-1],!e[r]){var c="function"==typeof __require&&__require;if(!_&&c)return c(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+n+"'")}n=r}var l=i[n]={exports:{}};e[n][0].call(l.exports,function(t){return a(e[n][1][t]||t)},l,l.exports,t,e,i,s)}return i[n].exports}for(var o="function"==typeof __require&&__require,n=0;n<s.length;n++)a(s[n]);return a}({Enemy:[function(t,e){"use strict";cc._RF.push(e,"204e3YiFzNJB5LlIZdl2q0Q","Enemy"),e.exports={Bear:0,Forkman:1,Small1:2,Gorilla:3,Small2:4,Carry:5,Small3:6},cc._RF.pop()},{}],abount_scene:[function(t,e){"use strict";cc._RF.push(e,"96a73HZ2+ZGoIihD0TX63+k","abount_scene");var i=t("sound_manager");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.door=cc.find("UI_ROOT/anchor-center/loading_door").getComponent("loading_door"),this.go_back=!1},start:function(){this.door.open_the_door(null)},goto_home:function(){!0!==this.go_back&&(i.play_effect("resources/sounds/click.wav"),this.go_back=!0,this.door.close_the_door(function(){cc.director.loadScene("home_scene",function(){cc.find("UI_ROOT").getComponent("home_scene").close_door()})}.bind(this)))}}),cc._RF.pop()},{sound_manager:"sound_manager"}],actor:[function(t,e){"use strict";cc._RF.push(e,"76677xeXapLhoRS3dt0Qusq","actor");var i=t("ugame"),s=cc.Class({name:"walk_anim_params",properties:{anim_frames:{type:cc.SpriteFrame,default:[]},anim_duration:.1,scale_x:1}});cc.Class({extends:cc.Component,properties:{walk_anim_set:{default:[],type:s}},onLoad:function(){this.speed=50,this.state=0,this.blood_bar=this.node.getChildByName("blood_bar").getComponent(cc.ProgressBar),this.anim=this.node.getChildByName("anim"),this.frame_anim=this.anim.addComponent("frame_anim"),this.anim_dir=-1,this.actor_params=null,this.game_scene=cc.find("UI_ROOT").getComponent("game_scene"),this.is_paused=!1},set_actor_params:function(t){this.actor_params=t,this.speed=this.actor_params.speed,this.health=this.actor_params.health,this.attack=this.actor_params.attack,this.player_hurt=this.actor_params.player_hurt},gen_at_road:function(t){t.length<2||(this.road_data=t,this.state=1,this.node.setPosition(t[0]),this.next_step=1,this.walk_to_next())},play_walk_anim:function(t){var e,i=Math.atan2(t.y,t.x);(e=i>=-Math.PI&&i<-.75*Math.PI?2:i>=-.75*Math.PI&&i<-.25*Math.PI?1:i>=-.25*Math.PI&&i<.25*Math.PI?3:i>=.25*Math.PI&&i<.75*Math.PI?0:2)!=this.anim_dir&&(this.anim_dir=e,this.frame_anim.stop_anim(),this.frame_anim.sprite_frames=this.walk_anim_set[this.anim_dir].anim_frames,this.frame_anim.duration=this.walk_anim_set[this.anim_dir].anim_duration,this.anim.scaleX=this.walk_anim_set[this.anim_dir].scale_x,this.frame_anim.play_loop())},walk_to_next:function(){this.state=1;var t=this.node.getPosition(),e=this.road_data[this.next_step].sub(t),i=e.mag();this.walk_time_total=i/this.speed,this.vx=this.speed*e.x/i,this.vy=this.speed*e.y/i,this.walk_time=0,this.play_walk_anim(e)},attack_player:function(){this.game_scene.on_player_attacked(this.player_hurt),i.remove_ememy(this.node),this.node.removeFromParent()},position_after_time:function(t){if(1!=this.state)return this.node.getPosition();for(var e=this.node.getPosition(),i=this.next_step;t>0&&i<this.road_data.length;){var s=this.road_data[i],a=s.sub(e),o=a.mag(),n=o/this.speed;if(!(t>n)){var _=this.speed*a.x/o*t,r=this.speed*a.y/o*t;return e.x+=_,e.y+=r,e}t-=n,e=s,i++}return this.road_data[i-1]},walk_update:function(t){if(1==this.state){this.walk_time+=t,this.walk_time>=this.walk_time_total&&(t-=this.walk_time-this.walk_time_total);var e=this.vx*t,i=this.vy*t;this.node.x+=e,this.node.y+=i,this.walk_time>=this.walk_time_total&&(this.next_step++,this.next_step>=this.road_data.length?(this.state=4,this.attack_player()):this.walk_to_next())}},update:function(t){if(!1!==i.is_game_started){if(i.is_game_paused)return this.frame_anim.stop_anim(),void(this.is_paused=!0);this.is_paused&&(this.frame_anim.play_loop(),this.is_paused=!1),1==this.state&&this.walk_update(t)}else this.frame_anim.stop_anim()},on_common_bullet_attack:function(t){if(this.health-=t,this.health<=0)this.health=0,i.add_chip(this.actor_params.bonues_chip),this.game_scene.show_game_uchip(),this.state=3,i.remove_ememy(this.node),this.node.removeFromParent();else{var e=this.health/this.actor_params.health;this.blood_bar.progress=e}},on_bomb_bullet_attack:function(t){this.on_common_bullet_attack(t)},on_warlock_bullet_attack:function(t){this.on_common_bullet_attack(t)},on_arrow_bullet_attack:function(t){this.on_common_bullet_attack(t)}}),cc._RF.pop()},{ugame:"ugame"}],arrow_bullet_params:[function(t,e){"use strict";cc._RF.push(e,"69838oYMuRDqZ7cnXlPwNNt","arrow_bullet_params"),e.exports=[{speed:200,attack:10},{speed:200,attack:10},{speed:200,attack:10},{speed:200,attack:10}],cc._RF.pop()},{}],arrow_bullet:[function(t,e){"use strict";cc._RF.push(e,"18914fcXwBC35QGjxAGKzmh","arrow_bullet");var i=t("ugame"),s=t("arrow_bullet_params");cc.Class({extends:cc.Component,properties:{speed:200,attack:10,bullet_level:1,arrow_sprite_frame:{default:null,type:cc.SpriteFrame},decal_arrow_sprite_frame:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.anim=this.node.getChildByName("anim")},shoot_at:function(t,e,i,a){if(this.node.parent){this.bullet_level=t,this.speed=s[this.bullet_level-1].speed,this.shoot_enemy=a;var o=this.node.parent.convertToNodeSpaceAR(e),n=this.node.parent.convertToNodeSpaceAR(i);this.node.setPosition(o),this.anim.rotation=90;var _,r,c=i.sub(e).mag()/this.speed;if(null!==this.shoot_enemy){var l=this.shoot_enemy.getComponent("actor").position_after_time(c);i=this.shoot_enemy.parent.convertToWorldSpace(l),n=this.node.parent.convertToNodeSpaceAR(i)}_=.5*(o.x+n.x),r=n.y>o.y?n.y:o.y,r+=40;var h,u=[cc.p(_,r),cc.p(_,r),n],m=cc.bezierTo(c,u),d=cc.callFunc(function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.decal_arrow_sprite_frame,this.on_bullet_shoot(i)}.bind(this),this.node),p=cc.callFunc(function(){this.node.removeFromParent()}.bind(this),this.node),f=cc.sequence([m,d,cc.delayTime(3),cc.fadeOut(.3),p]);this.node.runAction(f),h=i.x<e.x?10*Math.random()-180:180-10*Math.random();var g=cc.rotateBy(c,h);this.anim.runAction(g)}else console.log("shoot_at must add to parent first")},on_bullet_shoot:function(){null!==this.shoot_enemy&&i.is_enemy_active(this.shoot_enemy)&&(this.shoot_enemy.getComponent("actor").on_arrow_bullet_attack(s[this.bullet_level-1].attack),this.node.removeFromParent())}}),cc._RF.pop()},{arrow_bullet_params:"arrow_bullet_params",ugame:"ugame"}],arrow_tower_params:[function(t,e){"use strict";cc._RF.push(e,"f4765OYb71AwYt3TkilEYhx","arrow_tower_params"),e.exports=[{search_R:100,build_chip:100},{search_R:120,build_chip:220},{search_R:140,build_chip:340},{search_R:160,build_chip:540}],cc._RF.pop()},{}],arrow_tower:[function(t,e){"use strict";cc._RF.push(e,"4238csfSXpB64PT+lRxLXyz","arrow_tower");var i=t("ugame"),s=t("arrow_tower_params"),a=cc.Class({name:"arrow_tower_skin",properties:{tower_bg:{type:cc.SpriteFrame,default:null},up_idle:{type:cc.SpriteFrame,default:null},down_idle:{type:cc.SpriteFrame,default:null},up_anim:{default:[],type:cc.SpriteFrame},down_anim:{default:[],type:cc.SpriteFrame},man_ypos:29}});cc.Class({extends:cc.Component,properties:{tower_level:1,level_tower_skin_res:{default:[],type:a},anim_duration:.1,arrow_bullet_prefab:{default:null,type:cc.Prefab},boot_root_path:"UI_ROOT/map_root"},_set_tower_skin_by_level:function(){this.rhs.y=this.level_tower_skin_res[this.tower_level-1].man_ypos,this.lhs.y=this.level_tower_skin_res[this.tower_level-1].man_ypos,this.node.getComponent(cc.Sprite).spriteFrame=this.level_tower_skin_res[this.tower_level-1].tower_bg,Math.random()<.5?(this._set_anim_idle(this.lhs,0),this._set_anim_idle(this.rhs,0)):(this._set_anim_idle(this.lhs,1),this._set_anim_idle(this.rhs,1))},_set_anim_idle:function(t,e){t.getComponent(cc.Sprite).spriteFrame=0===e?this.level_tower_skin_res[this.tower_level-1].up_idle:this.level_tower_skin_res[this.tower_level-1].down_idle},onLoad:function(){this.tower_level=1,this.cur_anchor_index=0,this.lhs=this.node.getChildByName("lhs"),this.rhs=this.node.getChildByName("rhs"),this._set_tower_skin_by_level(),this.bullet_root=cc.find(this.boot_root_path)},_shoot_anim_at:function(t,e){var a=t.getComponent("frame_anim");a||(a=t.addComponent("frame_anim"));var o=t.convertToWorldSpaceAR(cc.p(0,0));e.sub(o).y>0?(a.sprite_frames=this.level_tower_skin_res[this.tower_level-1].up_anim,a.duration=this.anim_duration,a.play_once(function(){this._set_anim_idle(t,0)}.bind(this))):(a.sprite_frames=this.level_tower_skin_res[this.tower_level-1].down_anim,a.duration=this.anim_duration,a.play_once(function(){this._set_anim_idle(t,1)}.bind(this)));var n=this.tower_center_pos(),_=s[this.tower_level-1].search_R,r=i.search_enemy(n,_);r&&(e=r.convertToWorldSpaceAR(cc.p(0,0)));var c=cc.instantiate(this.arrow_bullet_prefab);this.bullet_root.addChild(c),c.active=!0,c.getComponent("arrow_bullet").shoot_at(this.tower_level,o,e,r)},shoot_at:function(t){0===this.cur_anchor_index?this._shoot_anim_at(this.lhs,t):this._shoot_anim_at(this.rhs,t),this.cur_anchor_index++,this.cur_anchor_index>=2&&(this.cur_anchor_index=0)},tower_center_pos:function(){var t=this.node.getPosition();return t.x+=-8,t.y+=-4,t},tower_think:function(){var t=this.tower_center_pos(),e=s[this.tower_level-1].search_R,a=i.search_enemy(t,e),o=.1;if(!i.is_game_paused&&a){var n=a.convertToWorldSpaceAR(cc.p(0,0));this.shoot_at(n),o=1}this.scheduleOnce(this.tower_think.bind(this),o)},start:function(){this.scheduleOnce(this.tower_think.bind(this),.1)},update:function(){},upgrade_tower:function(){return this.tower_level>=4?this.tower_level:(this.tower_level++,this._set_tower_skin_by_level(),this.tower_level)},get_tower_level:function(){return this.tower_level}}),cc._RF.pop()},{arrow_tower_params:"arrow_tower_params",ugame:"ugame"}],audio_swich:[function(t,e){"use strict";cc._RF.push(e,"c7dafJzhW5D7Ijaxs8lY6a9","audio_swich");var i=t("sound_manager");cc.Class({extends:cc.Component,properties:{type:0,off_spriteframe:{default:null,type:cc.SpriteFrame},on_spriteframe:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.sp=this.node.getComponent(cc.Sprite)},start:function(){0===this.type?i.b_music_mute?this.sp.spriteFrame=this.off_spriteframe:this.sp.spriteFrame=this.on_spriteframe:1===this.type&&(i.b_effect_mute?this.sp.spriteFrame=this.off_spriteframe:this.sp.spriteFrame=this.on_spriteframe)},on_switch_click:function(){var t;0===this.type?(t=i.b_music_mute?0:1,i.set_music_mute(t)):1===this.type&&(t=i.b_effect_mute?0:1,i.set_effect_mute(t)),this.sp.spriteFrame=t?this.off_spriteframe:this.on_spriteframe}}),cc._RF.pop()},{sound_manager:"sound_manager"}],cannon_bullet_params:[function(t,e){"use strict";cc._RF.push(e,"6a382LcfJtDlahl1bphvnJh","cannon_bullet_params"),e.exports=[{speed:200,attack:10,bomb_R:30},{speed:200,attack:20,bomb_R:30},{speed:200,attack:30,bomb_R:30},{speed:200,attack:30,bomb_R:30},{speed:200,attack:10,bomb_R:30}],cc._RF.pop()},{}],cannon_bullet:[function(t,e){"use strict";cc._RF.push(e,"8157fh0ijFA2rSH+ECEgoTL","cannon_bullet");var i=t("cannon_bullet_params"),s=t("ugame"),a=cc.Class({name:"bullet_skin",properties:{bullet_icon:{type:cc.SpriteFrame,default:null},bomb_anim_frames:{type:cc.SpriteFrame,default:[]},duration:.08}});cc.Class({extends:cc.Component,properties:{bullet_level:1,bullet_skin_res:{default:[],type:a}},onLoad:function(){this.anim=this.node.getChildByName("anim"),this.anim.addComponent("frame_anim"),this._set_bullet_idle()},_set_bullet_idle:function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.bullet_skin_res[this.bullet_level-1].bullet_icon},shoot_at:function(t,e,s){if(this.node.parent){this._set_bullet_idle(),this.bullet_level=t,this.phy_params=i[this.bullet_level-1];var a=this.node.parent.convertToNodeSpaceAR(e),o=this.node.parent.convertToNodeSpaceAR(s);this.node.setPosition(a),this.anim.rotation=0;var n,_,r=s.sub(e).mag()/this.phy_params.speed;n=.5*(a.x+o.x),_=o.y>a.y?o.y:a.y,_+=40;var c,l=[cc.p(n,_),cc.p(n,_),o],h=cc.bezierTo(r,l),u=cc.callFunc(function(){this.on_bullet_bomb(s),this.play_bullet_bomb_anim()}.bind(this),this.node),m=cc.sequence([h,u]);this.node.runAction(m),c=s.x<e.x?10*Math.random()-180:180-10*Math.random();var d=cc.rotateBy(r,c);this.anim.runAction(d)}},play_bullet_bomb_anim:function(){this.anim.rotation=0;var t=this.anim.getComponent("frame_anim");t.sprite_frames=this.bullet_skin_res[this.bullet_level-1].bomb_anim_frames,t.duration=this.bullet_skin_res[this.bullet_level-1].duration,t.play_once(function(){this.node.removeFromParent()}.bind(this))},on_bullet_bomb:function(){for(var t=this.phy_params.bomb_R,e=this.node.getPosition(),i=s.get_enemy_set(),a=0;a<i.length;a++)i[a].getPosition().sub(e).mag()<=t&&i[a].getComponent("actor").on_bomb_bullet_attack(this.phy_params.attack)}}),cc._RF.pop()},{cannon_bullet_params:"cannon_bullet_params",ugame:"ugame"}],cannon_tower_params:[function(t,e){"use strict";cc._RF.push(e,"f8ae2+23c1KvJYK/lVuhF5m","cannon_tower_params"),e.exports=[{search_R:100,build_chip:200},{search_R:120,build_chip:400},{search_R:140,build_chip:600},{search_R:160,build_chip:900}],cc._RF.pop()},{}],cannon_tower:[function(t,e){"use strict";cc._RF.push(e,"5cca9kF6thMWpUtcRmjT5VF","cannon_tower");var i=cc.Class({name:"tower_skin",properties:{shoot_anim:{default:[],type:cc.SpriteFrame},shoot_anim_duration:.1,shoot_bullet:{default:[],type:cc.SpriteFrame}}}),s=t("cannon_tower_params"),a=t("ugame");cc.Class({extends:cc.Component,properties:{tower_level:1,tower_skin_set:{default:[],type:i},bullet_prefab:{default:null,type:cc.Prefab},bullet_root_path:"UI_ROOT/map_root/bullet_root"},onLoad:function(){this.tower_level=1,this.anim=this.node.getChildByName("anim"),this.bullet_icon=this.anim.getChildByName("bullet_icon"),this.bullet_icon.scale=0,this.set_tower_idle(),this.bullet_root=cc.find(this.bullet_root_path)},set_tower_idle:function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.tower_skin_set[this.tower_level-1].shoot_anim[0]},_play_preload_bullet_anim:function(){if(4!==this.tower_level){var t=[cc.p(-24,2),cc.p(-24,3),cc.p(-24,2),cc.p(-24,2)],e=[cc.p(3,20),cc.p(3,21),cc.p(3,24),cc.p(3,24)],i=[180+90*Math.random(),180+90*Math.random(),45];this.bullet_icon.getComponent(cc.Sprite).spriteFrame=this.tower_skin_set[this.tower_level-1].shoot_bullet[0];var s=cc.delayTime([.8,1.5,1.2][this.tower_level-1]),a=cc.callFunc(function(){this.bullet_icon.scale=1,this.bullet_icon.x=t[this.tower_level-1].x,this.bullet_icon.y=t[this.tower_level-1].y,this.bullet_icon.rotation=-45;var e=cc.rotateBy(.4,i[this.tower_level-1]);this.bullet_icon.runAction(e)}.bind(this),this.bullet_icon),o=[cc.p(-10,30),cc.p(-10,30),e[this.tower_level-1]],n=cc.bezierTo(.4,o),_=cc.scaleTo(.1,0),r=cc.sequence([s,a,n,_]);this.bullet_icon.runAction(r)}},_shoot_bullet:function(t,e){var i=[cc.p(3,16),cc.p(3,16),cc.p(3,16),cc.p(-1,20),cc.p(-22,24)],o=this.anim.convertToWorldSpaceAR(i[e-1]),n=cc.delayTime([.7,.8,.6,1.3,3.5][e-1]),_=cc.callFunc(function(){var i=this.tower_center_pos(),n=s[this.tower_level-1].search_R,_=a.search_enemy(i,n);_&&(t=_.convertToWorldSpaceAR(cc.p(0,0)));var r=cc.instantiate(this.bullet_prefab);this.bullet_root.addChild(r);var c=r.getComponent("cannon_bullet");c.bullet_level=e,c.shoot_at(e,o,t)}.bind(this),this.node),r=cc.sequence([n,_]);this.node.runAction(r)},shoot_at:function(t){var e=this.anim.getComponent("frame_anim");e.sprite_frames=this.tower_skin_set[this.tower_level-1].shoot_anim,e.duration=this.tower_skin_set[this.tower_level-1].shoot_anim_duration,e.play_once(this.set_tower_idle.bind(this)),this._play_preload_bullet_anim(),this._shoot_bullet(t,this.tower_level),4===this.tower_level&&this._shoot_bullet(t,this.tower_level+1)},tower_center_pos:function(){var t=this.node.getPosition();return t.x+=-1,t.y+=8,t},tower_think:function(){var t=this.tower_center_pos(),e=s[this.tower_level-1].search_R,i=a.search_enemy(t,e),o=.1;if(!a.is_game_paused&&i){var n=i.convertToWorldSpaceAR(cc.p(0,0));this.shoot_at(n),o=1,4===this.tower_level&&(o=3.5)}this.scheduleOnce(this.tower_think.bind(this),o)},start:function(){this.scheduleOnce(this.tower_think.bind(this),.1)},upgrade_tower:function(){return this.tower_level>=4?this.tower_level:(this.tower_level++,this.set_tower_idle(),this.tower_level)},get_tower_level:function(){return this.tower_level}}),cc._RF.pop()},{cannon_tower_params:"cannon_tower_params",ugame:"ugame"}],checkout:[function(t,e){"use strict";cc._RF.push(e,"a192bAsW5lOvoTNVP49kGuk","checkout");var i=t("utils"),s=t("ugame");cc.Class({extends:cc.Component,properties:{game_tips:{default:[],type:cc.String}},onLoad:function(){this.failed_root=this.node.getChildByName("failed_root"),this.passed_root=this.node.getChildByName("passed_root"),this.tip=this.failed_root.getChildByName("tip").getComponent(cc.Label),this.star1=this.passed_root.getChildByName("star1"),this.star2=this.passed_root.getChildByName("star2"),this.star3=this.passed_root.getChildByName("star3")},show_failed:function(){if(this.node.active=!0,this.game_tips.length>0){var t=i.random_int(0,this.game_tips.length-1);this.tip.string=this.game_tips[t]}this.failed_root.active=!0,this.passed_root.active=!1},show_passed:function(t,e){this.node.active=!0,this.failed_root.active=!1,this.passed_root.active=!0;var i=1;this.star1.active=!0,e>2*t/3?(i=3,this.star2.active=!0,this.star3.active=!0):e>t/3?(i=2,this.star2.active=!0,this.star3.active=!1):(this.star2.active=!1,this.star3.active=!1);var a=s.get_cur_user(),o=s.get_cur_level();if(i>a.level_info[o]){var n=i-a.level_info[o];a.level_info[o]=i,a.star_num+=n,s.sync_user_data()}}}),cc._RF.pop()},{ugame:"ugame",utils:"utils"}],frame_anim:[function(t,e){"use strict";cc._RF.push(e,"d52c9TddN1Ki4vl6k/spD1L","frame_anim"),cc.Class({extends:cc.Component,properties:{sprite_frames:{default:[],type:cc.SpriteFrame},duration:.1,loop:!1,play_onload:!1},onLoad:function(){var t=this.node.getComponent(cc.Sprite);t||(t=this.node.addComponent(cc.Sprite)),this.sprite=t,this.is_playing=!1,this.play_time=0,this.is_loop=!1,this.end_func=null,this.sprite_frames.length>0&&(this.sprite.spriteFrame=this.sprite_frames[0]),this.play_onload&&(this.loop?this.play_loop():this.play_once(null))},play_once:function(t){this.play_time=0,this.is_playing=!0,this.is_loop=!1,this.end_func=t},play_loop:function(){this.play_time=0,this.is_playing=!0,this.is_loop=!0},stop_anim:function(){this.play_time=0,this.is_playing=!1,this.is_loop=!1},start:function(){},update:function(t){if(!1!==this.is_playing){this.play_time+=t;var e=Math.floor(this.play_time/this.duration);if(!1===this.is_loop){if(e>=this.sprite_frames.length)return this.sprite.spriteFrame=this.sprite_frames[this.sprite_frames.length-1],this.is_playing=!1,this.play_time=0,void(this.end_func&&this.end_func());this.sprite.spriteFrame=this.sprite_frames[e]}else{for(;e>=this.sprite_frames.length;)e-=this.sprite_frames.length,this.play_time-=this.duration*this.sprite_frames.length;this.sprite.spriteFrame=this.sprite_frames[e]}}}}),cc._RF.pop()},{}],game_scene:[function(t,e){"use strict";cc._RF.push(e,"3ee82Z8K8ZMWYWQ3rJ5VG0q","game_scene");var i=t("sound_manager"),s=t("ugame");cc.Class({extends:cc.Component,properties:{enemy_prefabs:{default:[],type:cc.Prefab},game_map_set:{default:[],type:cc.Prefab}},onLoad:function(){i.play_music("resources/sounds/music/game_bg1.mp3",!0),this.door=cc.find("UI_ROOT/loading_door").getComponent("loading_door"),this.go_back=!1,this.pause_root=cc.find("UI_ROOT/anchor-center/pause_root"),this.pause_root.active=!1,this.setting_root=cc.find("UI_ROOT/anchor-center/setting_root"),this.setting_root.active=!1,this.blood_label=cc.find("UI_ROOT/anchor-lt/ugame_root/blood_label").getComponent(cc.Label),this.uchip_label=cc.find("UI_ROOT/anchor-lt/ugame_root/uchip_label").getComponent(cc.Label),this.round_label=cc.find("UI_ROOT/anchor-lt/ugame_root/round_label").getComponent(cc.Label),this.blood=0,this.game_started=!1,s.is_game_paused=!1,this.map_root=cc.find("UI_ROOT/map_root"),this.checkout=cc.find("UI_ROOT/checkout").getComponent("checkout");var t=s.get_cur_level();t>=this.game_map_set.length&&(t=this.game_map_set.length-1),this.game_map=cc.instantiate(this.game_map_set[t]),this.node.addChild(this.game_map),this.game_map.zIndex=-100,this.map_tag_root=this.game_map.getChildByName("tag_root")},start_game:function(){if(!0!==this.game_started){this.all_enemy_gen=!1,s.clear_ememy_set(),this.unscheduleAllCallbacks();for(var e=0;e<this.map_tag_root.children.length;e++)this.map_tag_root.children[e].getComponent("tower_builder").remove_builder_tower();this.map_root.removeAllChildren(),this.game_started=!0,s.is_game_started=!0,this.checkout.node.active=!1;var i=s.get_cur_user();this.blood=i.blood,this.blood_label.string=""+this.blood,this.uchip_label.string=""+s.get_uchip(),this.round_label.string="round 0 / 7",this.map_level=s.get_cur_level();var a=this.map_level;a>=this.game_map_set.length&&(a=this.game_map_set.length-1),console.log("map_level #####",a,this.map_level),this.level_data=t("level"+(a+1)),this.round_label.string="round 0 / "+this.level_data.length,this.cur_round=0,this.cur_road_index=0,this.cur_gen_total=0,this.cur_gen_now=0,this.gen_round_enemy()}},show_game_uchip:function(){this.uchip_label.string=""+s.get_uchip()},start:function(){this.start_game(),this.door.open_the_door(null)},show_game_failed:function(){this.checkout.show_failed()},on_player_attacked:function(t){!1!==this.game_started&&(this.blood-=t,this.blood<=0&&(this.blood=0,this.game_started=!1,s.is_game_started=!1,this.show_game_failed()),this.blood_label.string=""+this.blood)},gen_one_enemy:function(){if(!1!==this.game_started)if(s.is_game_paused)this.scheduleOnce(this.gen_one_enemy.bind(this),this.cur_schedule_time);else{var t=this.level_data[this.cur_round],e=t.type[this.cur_gen_now],i=t.road_set,a=s.get_map_road_set(),o=cc.instantiate(this.enemy_prefabs[e]);o.active=!0,this.map_root.addChild(o),s.add_ememy(o);var n=o.getComponent("actor"),_=0;if(t.random_road){var r=Math.random()*i.length;(r=Math.floor(r))>=i.length&&(r=i.length-1),_=i[r]}else _=this.cur_road_index,this.cur_road_index++,this.cur_road_index>i.length&&(this.cur_road_index=0),_=i[_];_>=a.length&&(_=0);var c=a[_];if(n.set_actor_params(t.actor_params),n.gen_at_road(c),0===this.cur_gen_now&&(this.round_label.string="round "+(this.cur_round+1)+" / "+this.level_data.length),this.cur_gen_now++,this.cur_gen_now==this.cur_gen_total)this.cur_round++,this.gen_round_enemy();else{var l=t.gen_time_set[this.cur_gen_now];this.cur_schedule_time=l,this.scheduleOnce(this.gen_one_enemy.bind(this),l)}}},think_level_pass:function(){if(!1===this.game_started||!1===this.all_enemy_gen||s.ememy_set.length>0)this.scheduleOnce(this.think_level_pass.bind(this),.5);else{var t=s.get_cur_user();this.checkout.show_passed(t.blood,this.blood),this.game_started=!1}},gen_round_enemy:function(){if(this.cur_round>=this.level_data.length)return this.all_enemy_gen=!0,void this.scheduleOnce(this.think_level_pass.bind(this),.5);var t=this.level_data[this.cur_round],e=t.delay,i=t.num;this.cur_gen_total=i,this.cur_gen_now=0,this.cur_road_index=0,e+=t.gen_time_set[this.cur_gen_now],this.cur_schedule_time=e,this.scheduleOnce(this.gen_one_enemy.bind(this),e)},goto_roadmap_scene:function(){!0!==this.go_back&&(this.checkout.node.active=!1,i.play_effect("resources/sounds/click.wav"),this.go_back=!0,this.door.close_the_door(function(){cc.director.loadScene("roadmap_scene",function(){})}.bind(this)))},on_pause_click:function(){this.pause_root.active=!0,s.is_game_paused=!0},on_resume_game_click:function(){this.pause_root.active=!1,s.is_game_paused=!1},on_setting_click:function(){this.setting_root.active=!0,s.is_game_paused=!0},on_setting_close_click:function(){this.setting_root.active=!1,s.is_game_paused=!1},on_setting_replay_click:function(){this.setting_root.active=!1,this.game_started=!1,s.is_game_paused=!1,this.on_replay_game_click()},on_replay_game_click:function(){this.start_game()},on_start_game_click:function(){!0!==this.game_started&&(this.game_started=!0)}}),cc._RF.pop()},{sound_manager:"sound_manager",ugame:"ugame"}],gen_map_path:[function(t,e){"use strict";cc._RF.push(e,"6fd20Ro3IVH8pvqGwsBJ9cr","gen_map_path");var i=t("ugame");cc.Class({extends:cc.Component,properties:{is_debug:!1},onLoad:function(){this.anim_com=this.node.getComponent(cc.Animation);var t=this.anim_com.getClips()[0];this.graphics=this.node.addComponent(cc.Graphics),this.graphics.fillColor=cc.color(255,0,0,255);var e,s=t.curveData.paths;for(e in this.road_data_set=[],s){var a=s[e].props.position;this.gen_path_data(a)}this.is_debug&&this.draw_roads(),i.set_map_road_set(this.road_data_set)},start:function(){},get_road_set:function(){return this.road_data_set},gen_path_data:function(t){for(var e=null,i=null,s=null,a=null,o=[],n=0;n<t.length;n++){var _=t[n];null!==e&&o.push([i,e,e,cc.v2(_.value[0],_.value[1])]),i=cc.v2(_.value[0],_.value[1]);for(var r=0;r<_.motionPath.length;r++)s=cc.v2(_.motionPath[r][0],_.motionPath[r][1]),a=cc.v2(_.motionPath[r][2],_.motionPath[r][3]),null===e&&(e=a),o.push([i,e,a,s]),e=cc.v2(_.motionPath[r][4],_.motionPath[r][5]),i=s}console.log(o);for(var c=[o[0][0]],l=0;l<o.length;l++){i=o[l][0],e=o[l][1],a=o[l][2],s=o[l][3];var h=this.bezier_length(i,e,a,s)/16,u=1/(h=Math.floor(h)),m=u;for(n=0;n<h;n++){var d=i.x*(1-m)*(1-m)*(1-m)+3*e.x*m*(1-m)*(1-m)+3*a.x*m*m*(1-m)+s.x*m*m*m,p=i.y*(1-m)*(1-m)*(1-m)+3*e.y*m*(1-m)*(1-m)+3*a.y*m*m*(1-m)+s.y*m*m*m;c.push(cc.v2(d,p)),m+=u}}console.log(c),this.road_data_set.push(c)},draw_roads:function(t){this.graphics.clear();for(var e=0;e<this.road_data_set.length;e++){t=this.road_data_set[e];for(var i=0;i<t.length;i++)this.graphics.moveTo(t[i].x-1,t[i].y+1),this.graphics.lineTo(t[i].x-1,t[i].y-1),this.graphics.lineTo(t[i].x+1,t[i].y-1),this.graphics.lineTo(t[i].x+1,t[i].y+1),this.graphics.close()}this.graphics.fill()},bezier_length:function(t,e,i,s){for(var a=t,o=0,n=.05,_=0;_<20;_++){var r=t.x*(1-n)*(1-n)*(1-n)+3*e.x*n*(1-n)*(1-n)+3*i.x*n*n*(1-n)+s.x*n*n*n,c=t.y*(1-n)*(1-n)*(1-n)+3*e.y*n*(1-n)*(1-n)+3*i.y*n*n*(1-n)+s.y*n*n*n,l=cc.v2(r,c),h=l.sub(a);a=l,o+=h.mag(),n+=.05}return o}}),cc._RF.pop()},{ugame:"ugame"}],gui_tower_builder:[function(t,e){"use strict";cc._RF.push(e,"ddfc9gxo0VLlr2eKWHWN9yg","gui_tower_builder"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.gui_builder=this.node.getChildByName("gui_builder"),this.gui_undo=this.node.getChildByName("gui_undo"),this.node.active=!1,this.tower_builder=null},show_tower_builder:function(t){this.tower_builder=t,this.tower_builder&&(this.node.active=!0,this.gui_builder.active=!0,this.gui_undo.active=!1,this.node.x=t.node.x,this.node.y=t.node.y)},show_tower_undo:function(t){this.tower_builder=t,this.tower_builder&&(this.node.active=!0,this.gui_builder.active=!1,this.gui_undo.active=!0,this.node.x=t.node.x,this.node.y=t.node.y)},on_build_tower_click:function(t,e){this.tower_builder&&(this.tower_builder.on_tower_build_click(t,e),this.close_gui_builder())},on_undo_tower_click:function(){this.tower_builder&&(this.tower_builder.on_tower_undo_click(),this.close_gui_builder())},on_upgrade_tower_click:function(){this.tower_builder&&(this.tower_builder.on_tower_upgrade_click(),this.close_gui_builder())},close_gui_builder:function(){this.node.active=!1}}),cc._RF.pop()},{}],home_scene:[function(t,e){"use strict";cc._RF.push(e,"4decb+p4MFPXqd0g6zkxoTf","home_scene");var i=t("sound_manager"),s=t("ugame");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.loading_door=cc.find("UI_ROOT/anchor-center/loading_door").getComponent("loading_door"),this.game_started=!1,this.start_anim_com=cc.find("UI_ROOT/anchor-center/start_anim_root").getComponent(cc.Animation);var t=this.start_anim_com.getClips();this.start_click_animclip=t[1],this.uinfo_enter_anim_com=cc.find("UI_ROOT/anchor-center/user_game_info_root").getComponent(cc.Animation),this.outside=!1,i.play_music("resources/sounds/music/home_scene_bg.mp3",!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onKeyDown:function(t){console.log(t.keyCode)},set_star_score:function(t,e){t.getChildByName("star_score").getComponent(cc.Label).string=e.star_num+" / "+e.star_total},show_user_data:function(){this.set_star_score(cc.find("UI_ROOT/anchor-center/user_game_info_root/user1"),s.user_data[0]),this.set_star_score(cc.find("UI_ROOT/anchor-center/user_game_info_root/user2"),s.user_data[1]),this.set_star_score(cc.find("UI_ROOT/anchor-center/user_game_info_root/user3"),s.user_data[2])},start:function(){this.show_user_data(),this.scheduleOnce(function(){this.start_anim_com.play("home_scene_start_anim")}.bind(this),.5)},start_game:function(){this.game_started||(this.game_started=!0,i.play_effect("resources/sounds/click.wav"),this.start_anim_com.play("start_button_click_anim"),this.scheduleOnce(function(){this.uinfo_enter_anim_com.play("uinfo_enter_anim")}.bind(this),this.start_anim_com.currentClip.duration))},close_uinfo_dlg:function(){this.uinfo_enter_anim_com.play("reserve_uinfo_enter_anim"),this.scheduleOnce(function(){this.game_started=!1,this.start_anim_com.play("reserve_start_button_click_anim")}.bind(this),this.uinfo_enter_anim_com.currentClip.duration)},close_door:function(){this.loading_door.set_door_state(0),this.scheduleOnce(function(){this.loading_door.open_the_door()}.bind(this),.5)},goto_about:function(){this.outside||(this.outside=!0,i.play_effect("resources/sounds/click.wav"),this.loading_door.close_the_door(function(){this.scheduleOnce(function(){cc.director.loadScene("abount_scene")},.5)}.bind(this)))},on_user_entry_click:function(t,e){this.outside||(this.outside=!0,e=parseInt(e),s.set_cur_user(e),i.play_effect("resources/sounds/click.wav"),this.loading_door.close_the_door(function(){this.scheduleOnce(function(){cc.director.loadScene("roadmap_scene")},.5)}.bind(this)))}}),cc._RF.pop()},{sound_manager:"sound_manager",ugame:"ugame"}],httpc:[function(t,e){"use strict";cc._RF.push(e,"02a8eNldL5KjYLepVnCyS2p","httpc");var i={get:function(t,e){var i=cc.loader.getXMLHttpRequest();console.log(t),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&i.status>=200&&i.status<=207?err=!1:err=!0;var t=i.responseText;console.log(e),e(err,t)},i.send()}};e.exports=i,cc._RF.pop()},{}],infantry_actor_params:[function(t,e){"use strict";cc._RF.push(e,"3df35t6nbpOMrXrdPjFyU3j","infantry_actor_params"),e.exports=[{speed:50,attack:10,blood:100},{speed:50,attack:10,blood:100},{speed:50,attack:10,blood:100},{speed:50,attack:10,blood:100}],cc._RF.pop()},{}],infantry_actor:[function(t,e){"use strict";cc._RF.push(e,"4d726afPcdC6olF2jhCRgJq","infantry_actor");var i=t("infantry_actor_params"),s=cc.Class({name:"infantry_actor_skin",properties:{walk_anim:{type:cc.SpriteFrame,default:[]},walk_duration:.1,attack_anim:{type:cc.SpriteFrame,default:[]},attack_duration:.1,dead_anim:{type:cc.SpriteFrame,default:[]},dead_duration:.1}});cc.Class({extends:cc.Component,properties:{actor_level:1,actor_skin_set:{default:[],type:s}},_set_actor_idle:function(t){this.anim.scaleX=t?1:-1,this.anim.getComponent(cc.Sprite).spriteFrame=this.actor_skin_set[this.actor_level-1].walk_anim[0]},onLoad:function(){this.anim=this.node.getChildByName("anim"),this.anim.addComponent("frame_anim"),this._set_actor_idle(!0),this.state=0,this.walk_dst_pos=cc.p(0,0),this.walk_time=0,this.walk_vx=0,this.walk_vy=0,this.face_dir=1},gen_actor:function(t,e){this._set_actor_idle(!0),this.speed=i[this.actor_level-1].speed;var s=this.node.parent.convertToNodeSpaceAR(t);this.node.setPosition(s),this.walk_to_dst(e)},walk_to_dst:function(t){this.state=1,this.walk_dst_pos=this.node.parent.convertToNodeSpaceAR(t);var e=this.node.getPosition(),i=this.walk_dst_pos.sub(e),s=i.mag();this.walk_time=s/this.speed,this.walk_vx=this.speed*i.x/s,this.walk_vy=this.speed*i.y/s,this.walk_vx<0?(this.face_dir=0,this.anim.scaleX=-1):(this.face_dir=1,this.anim.scaleX=1);var a=this.anim.getComponent("frame_anim");a.sprite_frames=this.actor_skin_set[this.actor_level-1].walk_anim,a.duration=this.actor_skin_set[this.actor_level-1].walk_duration,a.play_loop()},actor_ai:function(){this.state},_walk_update:function(t){if(this.walk_time<=0)return this.state=0,this.anim.getComponent("frame_anim").stop_anim(),this._set_actor_idle(this.face_dir),this.walk_vx=0,void(this.walk_vy=0);this.walk_time<t&&(t=this.walk_time);var e=this.walk_vx*t,i=this.walk_vy*t;this.node.x+=e,this.node.y+=i,this.walk_time-=t},update:function(t){0!==this.state&&(1!==this.state||this._walk_update(t))}}),cc._RF.pop()},{infantry_actor_params:"infantry_actor_params"}],infantry_tower_params:[function(t,e){"use strict";cc._RF.push(e,"04a33Gq5qFEoJGcAUjUmIVq","infantry_tower_params"),e.exports=[{search_R:100,build_chip:150},{search_R:120,build_chip:300},{search_R:140,build_chip:450},{search_R:160,build_chip:600}],cc._RF.pop()},{}],infantry_tower:[function(t,e){"use strict";cc._RF.push(e,"8fa538vdAlKdJRwkIli718n","infantry_tower");var i=cc.Class({name:"infantry_skin",properties:{open_anim:{default:[],type:cc.SpriteFrame},anim_duration:.2}});cc.Class({extends:cc.Component,properties:{tower_level:1,tower_skin:{default:[],type:i},actor_prefab:{type:cc.Prefab,default:null},actor_root_path:"UI_ROOT/map_root/bullet_root"},_set_tower_idle:function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.tower_skin[this.tower_level-1].open_anim[0]},onLoad:function(){this.tower_level=1,this.anim=this.node.getChildByName("anim"),this.anim.addComponent("frame_anim"),this._set_tower_idle(),this.actor_root=cc.find(this.actor_root_path)},_play_open_door_anim:function(){var t=this.anim.getComponent("frame_anim");t.sprite_frames=this.tower_skin[this.tower_level-1].open_anim,t.duration=this.tower_skin[this.tower_level-1].anim_duration,t.play_once(this._set_tower_idle.bind(this))},_gen_actor:function(t){var e=cc.delayTime(.6),i=cc.callFunc(function(){var e=cc.instantiate(this.actor_prefab);this.actor_root.addChild(e),e.active=!0;var i=e.getComponent("infantry_actor");i.actor_level=this.tower_level,i.gen_actor(this.node.convertToWorldSpaceAR(cc.p(0,0)),t)}.bind(this),this.node),s=cc.sequence([e,i]);this.node.runAction(s)},gen_infantry:function(t){this._play_open_door_anim(),this._gen_actor(t)},start:function(){this.schedule(function(){var t=2*Math.random()*Math.PI,e=this.node.convertToWorldSpaceAR(cc.p(60*Math.cos(t),60*Math.sin(t)));this.gen_infantry(e)}.bind(this),4)},upgrade_tower:function(){return this.tower_level>=4?this.tower_level:(this.tower_level++,this._set_tower_idle(),this.tower_level)},get_tower_level:function(){return this.tower_level}}),cc._RF.pop()},{}],level1:[function(t,e){"use strict";cc._RF.push(e,"1ba57sJyDJChpl/9hycLRqL","level1");var i=t("Enemy"),s=[{desic:"3\u4e2a\u54e5\u5e03\u6797",delay:0,num:3,type:[i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5],random_road:!1,road_set:[1,0,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"6\u4e2a\u54e5\u5e03\u6797",delay:5,num:6,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.6,.6,3.6,.6,.6],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"9\u4e2a\u54e5\u5e03\u6797",delay:5,num:9,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,3,.5,.5,3,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"4\u4e2a\u54e5\u5e03\u6797\u548c1\u4e2a\u517d\u4eba",delay:5,num:5,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small3],gen_time_set:[0,.5,.5,.5,3.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"3\u4e2a\u517d\u4eba",delay:5,num:3,type:[i.Small3,i.Small3,i.Small3],gen_time_set:[0,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"10\u4e2a\u54e5\u5e03\u6797\u548c4\u4e2a\u517d\u4eba",delay:5,num:14,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3],gen_time_set:[0,.5,.5,.5,.5,3.5,.5,3.5,.5,.5,.5,.5,3.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{delay:5,num:16,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:50,player_hurt:1,bonues_chip:10}}];e.exports=s,cc._RF.pop()},{Enemy:"Enemy"}],level2:[function(t,e){"use strict";cc._RF.push(e,"e1410YgYRxFu6SNJxN5wgwp","level2");var i=t("Enemy"),s=[{desic:"3\u4e2a\u54e5\u5e03\u6797",delay:0,num:3,type:[i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5],random_road:!1,road_set:[1,0,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"6\u4e2a\u54e5\u5e03\u6797",delay:5,num:6,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.6,.6,3.6,.6,.6],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"9\u4e2a\u54e5\u5e03\u6797",delay:5,num:9,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,3,.5,.5,3,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"4\u4e2a\u54e5\u5e03\u6797\u548c1\u4e2a\u517d\u4eba",delay:5,num:5,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small3],gen_time_set:[0,.5,.5,.5,3.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"3\u4e2a\u517d\u4eba",delay:5,num:3,type:[i.Small3,i.Small3,i.Small3],gen_time_set:[0,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"10\u4e2a\u54e5\u5e03\u6797\u548c4\u4e2a\u517d\u4eba",delay:5,num:14,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3],gen_time_set:[0,.5,.5,.5,.5,3.5,.5,3.5,.5,.5,.5,.5,3.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{delay:5,num:16,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:50,player_hurt:1,bonues_chip:10}}];e.exports=s,cc._RF.pop()},{Enemy:"Enemy"}],level3:[function(t,e){"use strict";cc._RF.push(e,"daff1RbtjVE67wblH1P49bI","level3");var i=t("Enemy"),s=[{desic:"3\u4e2a\u54e5\u5e03\u6797",delay:0,num:3,type:[i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5],random_road:!1,road_set:[1,0,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"6\u4e2a\u54e5\u5e03\u6797",delay:5,num:6,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.6,.6,3.6,.6,.6],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"9\u4e2a\u54e5\u5e03\u6797",delay:5,num:9,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,3,.5,.5,3,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"4\u4e2a\u54e5\u5e03\u6797\u548c1\u4e2a\u517d\u4eba",delay:5,num:5,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small3],gen_time_set:[0,.5,.5,.5,3.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"3\u4e2a\u517d\u4eba",delay:5,num:3,type:[i.Small3,i.Small3,i.Small3],gen_time_set:[0,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{desic:"10\u4e2a\u54e5\u5e03\u6797\u548c4\u4e2a\u517d\u4eba",delay:5,num:14,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small3,i.Small3],gen_time_set:[0,.5,.5,.5,.5,3.5,.5,3.5,.5,.5,.5,.5,3.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:10,player_hurt:1,bonues_chip:10}},{delay:5,num:16,type:[i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1,i.Small1],gen_time_set:[0,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],random_road:!0,road_set:[0,1,2],actor_params:{speed:50,health:30,attack:50,player_hurt:1,bonues_chip:10}}];e.exports=s,cc._RF.pop()},{Enemy:"Enemy"}],level_entry_info:[function(t,e){"use strict";cc._RF.push(e,"5541egmkbFLZLHJrLRfMtL3","level_entry_info"),cc.Class({extends:cc.Component,properties:{star_num:1},onLoad:function(){this.star_set=[null,null,null],this.star_set[0]=this.node.getChildByName("star1").getChildByName("star"),this.star_set[1]=this.node.getChildByName("star2").getChildByName("star"),this.star_set[2]=this.node.getChildByName("star3").getChildByName("star"),this.show_level_star_info(this.star_num)},show_level_star_info:function(t){if(!(t<0||t>3)){var e;for(e=0;e<t;e++)this.star_set[e].active=!0;for(;e<3;e++)this.star_set[e].active=!1}}}),cc._RF.pop()},{}],loading_door:[function(t,e){"use strict";cc._RF.push(e,"264d3TUF0ZFjL8S3iM7GtEe","loading_door");var i=t("sound_manager");cc.Class({extends:cc.Component,properties:{door_state:0,anim_duration:.1},onLoad:function(){this.l_door=this.node.getChildByName("l_door"),this.r_door=this.node.getChildByName("r_door"),this._set_door_state(this.door_state)},start:function(){},_set_door_state:function(t){this.door_state=t;var e=cc.director.getWinSize();0===this.door_state?(this.l_door.x=2,this.r_door.x=-2):1===this.door_state&&(this.l_door.x=.5*-e.width,this.r_door.x=.5*e.width)},set_door_state:function(t){this.door_state!=t&&this._set_door_state(t)},close_the_door:function(t){if(0!==this.door_state){var e=cc.director.getWinSize();this.door_state=0,this.l_door.x=.5*-e.width,this.r_door.x=.5*e.width;var s=cc.moveBy(this.anim_duration,.5*e.width+2,0);this.l_door.runAction(s);var a=cc.moveBy(this.anim_duration,-(.5*e.width+2),0),o=cc.callFunc(function(){i.play_effect("resources/sounds/close_door.mp3"),t&&t()}.bind(this),this.l_door),n=cc.sequence([a,o]);this.r_door.runAction(n)}},open_the_door:function(t){if(1!==this.door_state){this.door_state=1,this.l_door.x=2,this.r_door.x=-2;var e=cc.director.getWinSize(),i=cc.moveBy(this.anim_duration,.5*-e.width-2,0);this.l_door.runAction(i);var s=cc.moveBy(this.anim_duration,.5*e.width+2,0),a=cc.callFunc(function(){t&&t()}.bind(this),this.r_door),o=cc.sequence([s,a]);this.r_door.runAction(o)}}}),cc._RF.pop()},{sound_manager:"sound_manager"}],roadmap_scene:[function(t,e){"use strict";cc._RF.push(e,"456eecCQaFN+KrZJX7drx7j","roadmap_scene");var i=t("sound_manager"),s=t("ugame");cc.Class({extends:cc.Component,properties:{level_num:19},onLoad:function(){i.play_music("resources/sounds/music/roadmap_scene_bg.mp3",!0),this.door=cc.find("UI_ROOT/loading_door").getComponent("loading_door"),this.outside=!1,this.new_level_entry=cc.find("UI_ROOT/anchor-center/new_level_entry"),this.new_level_entry.active=!1,this.passed_entry=[];for(var t=cc.find("UI_ROOT/anchor-center/map_entry_root"),e=0;e<this.level_num;e++){var s="level"+(e+1);this.passed_entry.push(t.getChildByName(s));var a=this.passed_entry[e].getComponent(cc.Button),o=new cc.Component.EventHandler;o.target=this.node,o.component="roadmap_scene",o.handler="on_passed_entry_click",o.customEventData=""+e,a.clickEvents=[o]}this.newest_level=-1,this.upgrade_config=cc.find("UI_ROOT/anchor-center/upgrade_config"),this.upgrade_config.active=!1},_show_user_star_info:function(){var t=cc.find("UI_ROOT/anchor-rt/game_star_info/star_num").getComponent(cc.Label),e=s.get_cur_user();t.string=e.star_num+" / "+e.star_total},_show_game_level_info:function(){var t=s.get_cur_user().level_info,e=0,i=t.length<this.level_num?t.length:this.level_num;for(e=0;e<i&&0!==t[e];e++)this.passed_entry[e].active=!0,this.passed_entry[e].getComponent("level_entry_info").show_level_star_info(t[e]);for(this.newest_level=e,this.newest_level>=this.level_num?(this.new_level_entry.active=!1,this.newest_level=this.level_num-1):(this.new_level_entry.active=!0,this.new_level_entry.x=this.passed_entry[this.newest_level].x,this.new_level_entry.y=this.passed_entry[this.newest_level].y);e<this.level_num;e++)this.passed_entry[e].active=!1},start:function(){this._show_game_level_info(),this._show_user_star_info(),this.door.open_the_door(null)},goto_home:function(){!0!==this.go_back&&(i.play_effect("resources/sounds/click.wav"),this.go_back=!0,this.door.close_the_door(function(){cc.director.loadScene("home_scene",function(){cc.find("UI_ROOT").getComponent("home_scene").close_door()})}.bind(this)))},_goto_game_scene:function(t){s.set_cur_level(t),console.log("enter game_scene at level:",s.get_cur_level()),this.door.close_the_door(function(){cc.director.loadScene("game_scene",function(){})}.bind(this))},on_new_entry_click:function(){!0!==this.outside&&(this.outside=!0,this._goto_game_scene(this.newest_level))},on_passed_entry_click:function(t,e){e=parseInt(e),!0!==this.outside&&(this.outside=!0,this._goto_game_scene(e))},on_skill_upgrade_config_click:function(){this.upgrade_config.active=!0,this.upgrade_config.getComponent(cc.Animation).play("road_skill_upgrade_config")}}),cc._RF.pop()},{sound_manager:"sound_manager",ugame:"ugame"}],sound_manager:[function(t,e){"use strict";cc._RF.push(e,"00b80fwJxpMArQhxOf7hXKJ","sound_manager"),console.log("###### init_audio manager ############");var i={b_music_mute:-1,b_effect_mute:-1,bg_music_name:null,bg_music_loop:!1,set_music_mute:function(t){this.b_music_mute!=t&&(this.b_music_mute=t?1:0,1===this.b_music_mute?cc.audioEngine.stopMusic(!1):0===this.b_music_mute&&(this.bg_music_name&&cc.audioEngine.playMusic(this.bg_music_name,this.bg_music_loop),cc.audioEngine.setMusicVolume(1)),cc.sys.localStorage.setItem("music_mute",this.b_music_mute))},set_effect_mute:function(t){this.b_effect_mute!=t&&(this.b_effect_mute=t?1:0,cc.sys.localStorage.setItem("effect_mute",this.b_effect_mute))},stop_music:function(){cc.audioEngine.stopMusic(!1),this.bg_music_name=null},play_music:function(t,e){cc.audioEngine.stopMusic(!1);var i=cc.url.raw(t);this.bg_music_name=i,this.bg_music_loop=e,this.b_music_mute||cc.audioEngine.playMusic(i,e)},play_effect:function(t){if(!this.b_effect_mute){var e=cc.url.raw(t);cc.audioEngine.playEffect(e)}}},s=cc.sys.localStorage.getItem("music_mute");s=s?parseInt(s):0,i.set_music_mute(s);var a=cc.sys.localStorage.getItem("effect_mute");a=a?parseInt(a):0,i.set_effect_mute(a),e.exports=i,cc._RF.pop()},{}],tower_builder:[function(t,e){"use strict";cc._RF.push(e,"80fe89FcsZCe7KxDkVtFQ5D","tower_builder");var i=t("ugame");cc.Class({extends:cc.Component,properties:{tower_prefabs:{type:cc.Prefab,default:[]},tower_offset:{type:cc.Vec2,default:[]}},onLoad:function(){this.gui_tower_builder=cc.find("UI_ROOT/gui_tower_builder").getComponent("gui_tower_builder"),this.icon=this.node.getChildByName("icon"),this.tower_type=0,this.builded_tower=null,this.is_builded=!1,this.map_root=cc.find("UI_ROOT/map_root"),this.tower_params=[null,null,null,null],this.tower_params[0]=t("arrow_tower_params"),this.tower_params[1]=t("warlock_tower_params"),this.tower_params[2]=t("cannon_tower_params"),this.tower_params[3]=t("infantry_tower_params"),this.game_scene=cc.find("UI_ROOT").getComponent("game_scene")},check_uchip_when_build:function(t,e){var s=this.tower_params[t-1][e-1].build_chip;return i.get_uchip()>=s},show_tower_builder:function(){var t=cc.scaleTo(.3,1).easing(cc.easeBackOut());!1===this.is_builded?(this.gui_tower_builder.show_tower_builder(this),this.gui_tower_builder.node.scale=0,this.gui_tower_builder.node.runAction(t)):(this.gui_tower_builder.show_tower_undo(this),this.gui_tower_builder.node.scale=0,this.gui_tower_builder.node.runAction(t))},remove_builder_tower:function(){!1!==this.is_builded&&(this.builded_tower.removeFromParent(),this.builded_tower=null,this.is_builded=!1,this.tower_type=0,this.icon.active=!0)},on_tower_undo_click:function(){if(!1!==this.is_builded){var t=this.get_build_tower_com().get_tower_level(),e=this.tower_params[this.tower_type-1][t-1].build_chip;i.add_chip(e),this.game_scene.show_game_uchip(),this.builded_tower.removeFromParent(),this.builded_tower=null,this.is_builded=!1,this.tower_type=0,this.icon.active=!0}},on_tower_build_click:function(t,e){if(!((e=parseInt(e))<=0||this.tower_type>4)&&this.check_uchip_when_build(e,1)){this.tower_type=e,this.icon.active=!1,this.builded_tower=cc.instantiate(this.tower_prefabs[e-1]),this.map_root.addChild(this.builded_tower);var s=this.node.getPosition();s.x+=this.tower_offset[e-1].x,s.y+=this.tower_offset[e-1].y,this.builded_tower.setPosition(s),this.builded_tower.active=!0,this.is_builded=!0;var a=this.tower_params[e-1][0].build_chip;i.add_chip(-a),this.game_scene.show_game_uchip()}},get_build_tower_com:function(){var t=null;switch(this.tower_type){case 1:t=this.builded_tower.getComponent("arrow_tower");break;case 2:t=this.builded_tower.getComponent("warlock_tower");break;case 3:t=this.builded_tower.getComponent("cannon_tower");break;case 4:t=this.builded_tower.getComponent("infantry_tower")}return t},on_tower_upgrade_click:function(){if(!1!==this.is_builded&&null!==this.builded_tower){var t=this.get_build_tower_com();if(!((s=t.get_tower_level())>=4)){var e=this.tower_params[this.tower_type-1][s].build_chip-this.tower_params[this.tower_type-1][s-1].build_chip;if(!(e>i.get_uchip())){if(t)var s=t.upgrade_tower();i.add_chip(-e),this.game_scene.show_game_uchip()}}}}}),cc._RF.pop()},{arrow_tower_params:"arrow_tower_params",cannon_tower_params:"cannon_tower_params",infantry_tower_params:"infantry_tower_params",ugame:"ugame",warlock_tower_params:"warlock_tower_params"}],ugame:[function(t,e){"use strict";cc._RF.push(e,"84288w8S8tJM7E2FkKrC8PL","ugame");var i={user_data:{0:null,1:null,2:null},cur_user:0,tower_skills_upgrade_config:{0:[0,1,1,2,2,3],1:[0,1,1,2,2,3],2:[0,1,1,2,2,3],3:[0,1,1,3,3,3],4:[0,1,1,2,2,3],5:[0,2,3,3,3,4]},cur_playing_level:0,is_game_started:!1,is_game_paused:!1,ememy_set:[],clear_ememy_set:function(){this.ememy_set=[]},is_enemy_active:function(t){var e=this.ememy_set.indexOf(t);return!(e<0||e>=this.ememy_set.length)},add_ememy:function(t){this.ememy_set.push(t)},remove_ememy:function(t){var e=this.ememy_set.indexOf(t);this.ememy_set.splice(e,1)},get_enemy_set:function(){return i.ememy_set},search_enemy:function(t,e){for(var s=0;s<i.ememy_set.length;s++)if(e>=i.ememy_set[s].getPosition().sub(t).mag())return i.ememy_set[s];return null},add_chip:function(t){i.get_cur_user().chip+=t,i.sync_user_data()},get_uchip:function(){return i.get_cur_user().chip},sync_user_data:function(){var t=JSON.stringify(i.user_data);cc.sys.localStorage.setItem("user_data",t)},set_cur_user:function(t){(t<0||t>=3)&&(t=0),i.cur_user=t},get_cur_user:function(){return i.user_data[i.cur_user]},set_cur_level:function(t){i.cur_playing_level=t},get_cur_level:function(){return i.cur_playing_level},set_map_road_set:function(t){i.map_road_set=t},get_map_road_set:function(){return i.map_road_set}};(function(){var t=cc.sys.localStorage.getItem("user_data");if(t)return i.user_data=JSON.parse(t),console.log("load from localStorage ######"),void console.log(i.user_data);i.user_data={0:{chip:2e3,blood:20,level_info:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],star_num:0,star_total:77,skill_level_info:[0,0,0,0,0,0]},1:{chip:2e3,blood:20,level_info:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],star_num:0,star_total:77,skill_level_info:[0,0,0,0,0,0]},2:{chip:2e3,blood:20,level_info:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],star_num:0,star_total:77,skill_level_info:[0,0,0,0,0,0]}},i.sync_user_data()})(),function(){for(var t=0;t<3;t++){i.user_data[t].star_num=0;for(var e=0;e<i.user_data[t].level_info.length;e++)i.user_data[t].star_num+=i.user_data[t].level_info[e]}}(),e.exports=i,cc._RF.pop()},{}],upgrade_config:[function(t,e){"use strict";cc._RF.push(e,"3f2a1fcJ2ZJ5qrVeKZcrgL0","upgrade_config");var i=t("ugame");cc.Class({extends:cc.Component,properties:{},_set_button_state:function(t,e){var i=t.getComponent(cc.Button),s=t.getChildByName("star_bg").getComponent(cc.Button),a=t.getChildByName("star_str").getComponent(cc.Button);0===e?(i.interactable=!1,i.enableAutoGrayEffect=!0,s.interactable=!1,s.enableAutoGrayEffect=!0,a.interactable=!1,a.enableAutoGrayEffect=!0,t.getChildByName("star_bg").active=!0,t.getChildByName("star_str").active=!0):1===e?(i.interactable=!0,s.interactable=!1,s.enableAutoGrayEffect=!1,a.interactable=!1,a.enableAutoGrayEffect=!1,t.getChildByName("star_bg").active=!0,t.getChildByName("star_str").active=!0):2===e&&(i.interactable=!1,i.enableAutoGrayEffect=!1,t.getChildByName("star_bg").active=!1,t.getChildByName("star_str").active=!1)},onLoad:function(){this.outside=!1;var t=this.node.getChildByName("anim_root");this.last_str_lable=t.getChildByName("last_star").getComponent(cc.Label),this.config_items=[];for(var e=0;e<6;e++){for(var s=[],a=t.getChildByName("skill"+(e+1)),o=0;o<5;o++){var n=a.getChildByName(""+(o+1));s.push(n);var _=n.addComponent(cc.Button),r=new cc.Component.EventHandler;r.target=this.node,r.component="upgrade_config",r.handler="on_config_item_click",r.customEventData=e+1+""+(o+1),_.clickEvents=[r],n.getChildByName("star_bg").addComponent(cc.Button),n.getChildByName("star_str").addComponent(cc.Button),this._set_button_state(n,1)}this.config_items.push(s)}var c=i.get_cur_user();this._show_skill_upgrade_config(c.skill_level_info,c.star_num)},_show_skill_upgrade_config:function(t,e){var s,a,o,n=e;for(s=0;s<t.length;s++)for(o=t[s],a=0;a<=o;a++)n-=i.tower_skills_upgrade_config[s][a];for(s=0;s<t.length;s++){o=t[s];var _=this.config_items[s];for(a=0,a=0;a<o;a++)this._set_button_state(_[a],2);for(a<5&&n>=i.tower_skills_upgrade_config[s][o+1]&&(this._set_button_state(_[a],1),a++);a<5;a++)this._set_button_state(_[a],0)}this.last_str_lable.string=""+n},on_config_item_click:function(t,e){if(!0!==this.outside){e=parseInt(e),console.log(e);var s=Math.floor(e/10),a=e-10*s;s--;var o=i.get_cur_user();o.skill_level_info[s]=a,this._show_skill_upgrade_config(o.skill_level_info,o.star_num)}},on_done_click:function(){if(!0!==this.outside){this.outside=!0,i.sync_user_data();var t=this.node.getComponent(cc.Animation);t.play("reserve_road_skill_upgrade_config"),this.scheduleOnce(function(){this.node.active=!1,this.outside=!1}.bind(this),t.currentClip.duration)}},on_reset_click:function(){if(!0!==this.outside){var t=i.get_cur_user();t.skill_level_info=[0,0,0,0,0,0],this._show_skill_upgrade_config(t.skill_level_info,t.star_num)}}}),cc._RF.pop()},{ugame:"ugame"}],"use_v2.0.x_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"0d444BW5q5K8J0ctY/9rg1A","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}],utils:[function(t,e){"use strict";cc._RF.push(e,"31607bEz7FELZjs3vghbzoF","utils");var i={random_int:function(t,e){var i=t+Math.random()*(e-t+1);return(i=Math.floor(i))>e&&(i=e),i}};e.exports=i,cc._RF.pop()},{}],warlock_bullet_params:[function(t,e){"use strict";cc._RF.push(e,"d05641sqONKkab4hl7TWCZX","warlock_bullet_params"),e.exports=[{speed:200,attack:10},{speed:200,attack:10},{speed:200,attack:10},{speed:200,attack:10}],cc._RF.pop()},{}],warlock_bullet:[function(t,e){"use strict";cc._RF.push(e,"a0eab9LMc5JYYLSFDiTyT3o","warlock_bullet");var i=t("ugame"),s=t("warlock_bullet_params"),a=cc.Class({name:"warlock_bullet_skin",properties:{bullet_icon:{type:cc.SpriteFrame,default:null},bomb_anim:{type:cc.SpriteFrame,default:[]},bomb_duration:.1}});cc.Class({extends:cc.Component,properties:{bullet_level:1,bullet_skin_set:{default:[],type:a}},onLoad:function(){this.anim=this.node.getChildByName("anim"),this.anim.addComponent("frame_anim")},_set_bullet_idle:function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.bullet_skin_set[this.bullet_level-1].bullet_icon},shoot_at:function(t,e,i,a){if(this.node.parent){this.bullet_level=t,this.shoot_enemy=a,this._set_bullet_idle();var o=this.node.parent.convertToNodeSpace(e);this.node.parent.convertToNodeSpace(i),this.node.setPosition(o);var n=i.sub(e).mag()/s[this.bullet_level-1].speed;if(null!==this.shoot_enemy){var _=this.shoot_enemy.getComponent("actor").position_after_time(n);i=this.shoot_enemy.parent.convertToWorldSpace(_)}var r=cc.moveBy(n,i.x-e.x,i.y-e.y),c=cc.callFunc(function(){var t=this.anim.getComponent("frame_anim");t.sprite_frames=this.bullet_skin_set[this.bullet_level-1].bomb_anim,t.duration=this.bullet_skin_set[this.bullet_level-1].bomb_duration,t.play_once(function(){this.on_bullet_bomb(i),this.node.removeFromParent()}.bind(this))}.bind(this),this.anim),l=cc.sequence([r,c]);this.node.runAction(l)}},on_bullet_bomb:function(){null!==this.shoot_enemy&&i.is_enemy_active(this.shoot_enemy)&&this.shoot_enemy.getComponent("actor").on_warlock_bullet_attack(s[this.bullet_level-1].attack)}}),cc._RF.pop()},{ugame:"ugame",warlock_bullet_params:"warlock_bullet_params"}],warlock_tower_params:[function(t,e){"use strict";cc._RF.push(e,"c14bcbhn5FEF4So3r6HAszc","warlock_tower_params"),e.exports=[{search_R:100,build_chip:150},{search_R:120,build_chip:300},{search_R:140,build_chip:450},{search_R:160,build_chip:600}],cc._RF.pop()},{}],warlock_tower:[function(t,e){"use strict";cc._RF.push(e,"82969K+ffBH3aG5fF/Chrw2","warlock_tower");var i=t("ugame"),s=t("warlock_tower_params"),a=cc.Class({name:"warlock_skin",properties:{tower_anim:{default:[],type:cc.SpriteFrame},tower_anim_duration:.1,shoot_up_anim:{default:[],type:cc.SpriteFrame},up_anim_duration:.1,shoot_down_anim:{default:[],type:cc.SpriteFrame},down_anim_duration:.1,xpos:-1,ypos:19}});cc.Class({extends:cc.Component,properties:{tower_level:1,tower_skin_set:{default:[],type:a},bullet_prefab:{default:null,type:cc.Prefab},bullet_root_path:"UI_ROOT/map_root/bullet_root"},onLoad:function(){this.tower_level=1,this.anim=this.node.getChildByName("anim"),this.anim.addComponent("frame_anim"),this.man=this.node.getChildByName("man"),this.man.addComponent("frame_anim"),this._set_tower_idle(),this._set_man_idle(!0),this.bullet_root=cc.find(this.bullet_root_path)},_set_tower_idle:function(){this.anim.getComponent(cc.Sprite).spriteFrame=this.tower_skin_set[this.tower_level-1].tower_anim[0]},_set_man_idle:function(t){this.man.x=this.tower_skin_set[this.tower_level-1].xpos,this.man.y=this.tower_skin_set[this.tower_level-1].ypos,this.man.getComponent(cc.Sprite).spriteFrame=t?this.tower_skin_set[this.tower_level-1].shoot_up_anim[0]:this.tower_skin_set[this.tower_level-1].shoot_down_anim[0]},_play_tower_anim:function(){var t=this.anim.getComponent("frame_anim");t.sprite_frames=this.tower_skin_set[this.tower_level-1].tower_anim,t.duration=this.tower_skin_set[this.tower_level-1].tower_anim_duration,t.play_once(this._set_tower_idle.bind(this))},_shoot_bullet:function(t,e){var a,o,n=[cc.p(6,6),cc.p(6,6),cc.p(6,6),cc.p(6,6),cc.p(6,6)],_=[cc.p(-5,8),cc.p(-5,8),cc.p(-5,8),cc.p(-5,8)];e?(a=[.6,.6,.6,.6][this.tower_level-1],o=n[this.tower_level-1]):(a=[.5,.5,.5,.5][this.tower_level-1],o=_[this.tower_level-1]);var r=cc.delayTime(a),c=cc.callFunc(function(){var e=this.tower_center_pos(),a=s[this.tower_level-1].search_R,n=i.search_enemy(e,a);n&&(t=n.convertToWorldSpaceAR(cc.p(0,0)));var _=this.man.convertToWorldSpaceAR(o),r=cc.instantiate(this.bullet_prefab);this.bullet_root.addChild(r),r.active=!0,r.getComponent("warlock_bullet").shoot_at(this.tower_level,_,t,n)}.bind(this),this.node),l=cc.sequence([r,c]);this.node.runAction(l)},_play_shoot_man_anim:function(t){var e=this.man.getComponent("frame_anim"),i=this.man.convertToWorldSpaceAR(cc.p(0,0)).y<t.y;i?(e.sprite_frames=this.tower_skin_set[this.tower_level-1].shoot_up_anim,e.duration=this.tower_skin_set[this.tower_level-1].up_anim_duration):(e.sprite_frames=this.tower_skin_set[this.tower_level-1].shoot_down_anim,e.duration=this.tower_skin_set[this.tower_level-1].down_anim_duration),e.play_once(function(){this._set_man_idle(i)}.bind(this)),this._shoot_bullet(t,i)},shoot_at:function(t){this._play_tower_anim(),this._play_shoot_man_anim(t)},tower_center_pos:function(){var t=this.node.getPosition();return t.x+=-5,t.y+=7,t},tower_think:function(){var t=this.tower_center_pos(),e=s[this.tower_level-1].search_R,a=i.search_enemy(t,e),o=.1;if(!i.is_game_paused&&a){var n=a.convertToWorldSpaceAR(cc.p(0,0));this.shoot_at(n),o=1}this.scheduleOnce(this.tower_think.bind(this),o)},start:function(){this.scheduleOnce(this.tower_think.bind(this),.1)},upgrade_tower:function(){return this.tower_level>=4?this.tower_level:(this.tower_level++,this._set_tower_idle(),this._set_man_idle(!0),this.tower_level)},get_tower_level:function(){return this.tower_level}}),cc._RF.pop()},{ugame:"ugame",warlock_tower_params:"warlock_tower_params"}],websocket:[function(t,e){"use strict";cc._RF.push(e,"cf427fHHDVIhZaHej4Gd93f","websocket");var i={sock:null,cmd_handler:null,_on_opened:function(){console.log("ws connect server success")},_on_recv_data:function(t){if(this.cmd_handler){var e=JSON.parse(t);if(e){var i=e[0];this.cmd_handler[i]&&this.cmd_handler[i](e)}}},_on_socket_close:function(){this.sock&&this.close()},_on_socket_err:function(){console.log("event"),this.close()},connect:function(t){this.sock=new WebSocket(t),this.sock.onopen=this._on_opened,this.sock.onmessage=this._on_recv_data,this.sock.onclose=this._on_socket_close,this.sock.onerror=this._on_socket_err},send:function(t){this.sock&&this.sock.send(t)},send_object:function(t){if(this.sock&&t){var e=JSON.stringify(t);e&&this.sock.send(e)}},close:function(){null!==this.sock&&(this.sock.close(),this.sock=null)},register_cmd_handler:function(t){this.cmd_handler=t}};e.exports=i,cc._RF.pop()},{}],zsort_node:[function(t,e){"use strict";cc._RF.push(e,"48f96yjbpxParY0VSI27tMA","zsort_node"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},update:function(){var t=this.node.children;t.sort(function(t,e){return t.y>e.y?-1:t.y<e.y?1:0});for(var e=0;e<t.length;e++)t[e].zIndex=1e3+e}}),cc._RF.pop()},{}]},{},["use_v2.0.x_cc.Toggle_event","abount_scene","audio_swich","frame_anim","arrow_bullet_params","arrow_tower_params","cannon_bullet_params","cannon_tower_params","infantry_actor_params","infantry_tower_params","level1","level2","level3","warlock_bullet_params","warlock_tower_params","game_scene","actor","arrow_bullet","arrow_tower","cannon_bullet","cannon_tower","checkout","gen_map_path","gui_tower_builder","infantry_actor","infantry_tower","tower_builder","warlock_bullet","warlock_tower","zsort_node","home_scene","loading_door","Enemy","httpc","sound_manager","ugame","utils","websocket","roadmap_scene","level_entry_info","upgrade_config"]);